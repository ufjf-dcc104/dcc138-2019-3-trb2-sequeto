<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="Sprite.js"></script>
    <script src="Scene.js"></script>
    <title>Game</title>
</head>
<body>
    <canvas/>

    <script>
        // Variáveis
        var canvas = document.querySelector("canvas");
        canvas.width = 600;
        canvas.height = 400;
        var ctx = canvas.getContext("2d");
        var dt, anterior = 0;
        var controle = { esquerda: 0, cima: 0, direita: 0, baixo: 0 };

        var personagem = new Sprite({x:10, y:10, vx:10, vy:0, w:20, h:20, comportamento: Controlar(controle)});
        var cena = new Scene({w:canvas.widht, h:canvas.height, ctx:ctx});
        cena.desenhar();

        cena.adicionar(personagem);

        // Controle
        function Controlar(controle) {
            return function() {
                // Botões Apertados
                if (controle.cima) {
                    this.vy = -50;
                }
                else
                if (controle.baixo) {
                    this.vy = 50;
                }

                if (controle.esquerda) {
                    this.vx = -50;
                }
                if (controle.direita) {
                    this.vx = 50;
                }

                // Botões Soltos
                if (!controle.cima && !controle.baixo) {
                    this.vy = 0;
                }

                if (!controle.esquerda && !controle.direita) {
                    this.vx = 0;
                }
            }
        }

        // Escuta das controle
        addEventListener("keydown", function (e) {
            switch (e.keyCode) {
                case 38:
                    controle.cima = 1;
                    break;
                case 37:
                    controle.esquerda = 1;
                    break;
                case 39:
                    controle.direita = 1;
                    break;
                case 40:
                    controle.baixo = 1;
                    break;
            }
        });

        addEventListener("keyup", function (e) {
            switch (e.keyCode) {
                case 38:
                    controle.cima = 0;
                    break;
                case 37:
                    controle.esquerda = 0;
                    break;
                case 39:
                    controle.direita = 0;
                    break;
                case 40:
                    controle.baixo = 0;
                    break;
            }
        });

        // Loop
        function passo(t){
            dt = (t - anterior)/1000;
            cena.passo(dt);
            anterior = t;
            requestAnimationFrame(passo);
        }

        requestAnimationFrame(passo);
    </script>
    
</body>
</html>